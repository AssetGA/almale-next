"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("src/middleware",{

/***/ "(middleware)/./src/app/lib/session.js":
/*!********************************!*\
  !*** ./src/app/lib/session.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createSession: () => (/* binding */ createSession),\n/* harmony export */   decrypt: () => (/* binding */ decrypt),\n/* harmony export */   deleteSession: () => (/* binding */ deleteSession),\n/* harmony export */   encrypt: () => (/* binding */ encrypt),\n/* harmony export */   getSessionCookie: () => (/* binding */ getSessionCookie),\n/* harmony export */   updateSession: () => (/* binding */ updateSession)\n/* harmony export */ });\n/* harmony import */ var server_only__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! server-only */ \"(middleware)/./node_modules/next/dist/compiled/server-only/empty.js\");\n/* harmony import */ var server_only__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(server_only__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/headers */ \"(middleware)/./node_modules/next/dist/esm/api/headers.js\");\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! jose */ \"(middleware)/./node_modules/jose/dist/browser/jwt/sign.js\");\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! jose */ \"(middleware)/./node_modules/jose/dist/browser/jwt/verify.js\");\n\n\n\nconst secretKey = process.env.SESSION_SECRET;\nconst encodedKey = new TextEncoder().encode(secretKey);\nasync function encrypt(payload) {\n    return new jose__WEBPACK_IMPORTED_MODULE_2__.SignJWT(payload).setProtectedHeader({\n        alg: \"HS256\"\n    }).setIssuedAt().setExpirationTime(\"1d\").sign(encodedKey);\n}\nasync function decrypt(session) {\n    try {\n        const { payload } = await (0,jose__WEBPACK_IMPORTED_MODULE_3__.jwtVerify)(session, encodedKey, {\n            algorithms: [\n                \"HS256\"\n            ]\n        });\n        return payload;\n    } catch (error) {\n        console.log(\"Failed to verify session\");\n    }\n}\n// export async function fetchCreateSession(id) {\n//   try {\n//     const url = new URL(`${process.env.NEXT_PUBLIC_SITE_URL}/lib/api/session`);\n//     url.searchParams.append(\"id\", id); // Добавляем параметр lang\n//     const res = await fetch(url.toString(), {\n//       method: \"POST\", // Указываем метод POST\n//       headers: {\n//         \"Content-Type\": \"application/json\", // Устанавливаем заголовок\n//       },\n//       body: JSON.stringify({ id }), // Передаём данные в теле запроса\n//     });\n//     if (!res.ok) throw new Error(\"Ошибка при загрузке товаров\");\n//     const session = await res.json();\n//     return session;\n//   } catch (error) {\n//     console.error(\"Error fetching products:\", error);\n//     return []; // Возвращаем пустой массив, если произошла ошибка\n//   }\n// }\nasync function createSession(id) {\n    const expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000);\n    // 2. Encrypt the session ID\n    const session = await encrypt({\n        userId: id,\n        expiresAt: expiresAt,\n        role: \"user\"\n    });\n    // 3. Store the session in cookies for optimistic auth checks\n    const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)();\n    cookieStore.set(\"session\", session, {\n        httpOnly: true,\n        secure: true,\n        expires: expiresAt,\n        sameSite: \"lax\",\n        path: \"/\"\n    });\n}\nasync function updateSession() {\n    const session = (await (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)()).get(\"session\")?.value;\n    const payload = await decrypt(session);\n    if (!session || !payload) {\n        return null;\n    }\n    const expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000);\n    const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)();\n    cookieStore.set(\"session\", session, {\n        httpOnly: true,\n        secure: true,\n        expires: expiresAt,\n        sameSite: \"lax\",\n        path: \"/\"\n    });\n}\nfunction getSessionCookie() {\n    return (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)().get(\"session\");\n}\nasync function deleteSession() {\n    const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)();\n    cookieStore.delete(\"session\");\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKG1pZGRsZXdhcmUpLy4vc3JjL2FwcC9saWIvc2Vzc2lvbi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFxQjtBQUNrQjtBQUNHO0FBRTFDLE1BQU1HLFlBQVlDLFFBQVFDLEdBQUcsQ0FBQ0MsY0FBYztBQUM1QyxNQUFNQyxhQUFhLElBQUlDLGNBQWNDLE1BQU0sQ0FBQ047QUFFckMsZUFBZU8sUUFBUUMsT0FBTztJQUNuQyxPQUFPLElBQUlWLHlDQUFPQSxDQUFDVSxTQUNoQkMsa0JBQWtCLENBQUM7UUFBRUMsS0FBSztJQUFRLEdBQ2xDQyxXQUFXLEdBQ1hDLGlCQUFpQixDQUFDLE1BQ2xCQyxJQUFJLENBQUNUO0FBQ1Y7QUFFTyxlQUFlVSxRQUFRQyxPQUFPO0lBQ25DLElBQUk7UUFDRixNQUFNLEVBQUVQLE9BQU8sRUFBRSxHQUFHLE1BQU1ULCtDQUFTQSxDQUFDZ0IsU0FBU1gsWUFBWTtZQUN2RFksWUFBWTtnQkFBQzthQUFRO1FBQ3ZCO1FBQ0EsT0FBT1I7SUFDVCxFQUFFLE9BQU9TLE9BQU87UUFDZEMsUUFBUUMsR0FBRyxDQUFDO0lBQ2Q7QUFDRjtBQUVBLGlEQUFpRDtBQUNqRCxVQUFVO0FBQ1Ysa0ZBQWtGO0FBQ2xGLG9FQUFvRTtBQUNwRSxnREFBZ0Q7QUFDaEQsZ0RBQWdEO0FBQ2hELG1CQUFtQjtBQUNuQix5RUFBeUU7QUFDekUsV0FBVztBQUNYLHdFQUF3RTtBQUN4RSxVQUFVO0FBRVYsbUVBQW1FO0FBQ25FLHdDQUF3QztBQUN4QyxzQkFBc0I7QUFDdEIsc0JBQXNCO0FBQ3RCLHdEQUF3RDtBQUN4RCxvRUFBb0U7QUFDcEUsTUFBTTtBQUNOLElBQUk7QUFFRyxlQUFlQyxjQUFjQyxFQUFFO0lBQ3BDLE1BQU1DLFlBQVksSUFBSUMsS0FBS0EsS0FBS0MsR0FBRyxLQUFLLElBQUksS0FBSyxLQUFLLEtBQUs7SUFFM0QsNEJBQTRCO0lBRTVCLE1BQU1ULFVBQVUsTUFBTVIsUUFBUTtRQUM1QmtCLFFBQVFKO1FBQ1JDLFdBQVdBO1FBQ1hJLE1BQU07SUFDUjtJQUVBLDZEQUE2RDtJQUM3RCxNQUFNQyxjQUFjLE1BQU05QixxREFBT0E7SUFDakM4QixZQUFZQyxHQUFHLENBQUMsV0FBV2IsU0FBUztRQUNsQ2MsVUFBVTtRQUNWQyxRQUFRO1FBQ1JDLFNBQVNUO1FBQ1RVLFVBQVU7UUFDVkMsTUFBTTtJQUNSO0FBQ0Y7QUFFTyxlQUFlQztJQUNwQixNQUFNbkIsVUFBVSxDQUFDLE1BQU1sQixxREFBT0EsRUFBQyxFQUFHc0MsR0FBRyxDQUFDLFlBQVlDO0lBQ2xELE1BQU01QixVQUFVLE1BQU1NLFFBQVFDO0lBRTlCLElBQUksQ0FBQ0EsV0FBVyxDQUFDUCxTQUFTO1FBQ3hCLE9BQU87SUFDVDtJQUVBLE1BQU1jLFlBQVksSUFBSUMsS0FBS0EsS0FBS0MsR0FBRyxLQUFLLElBQUksS0FBSyxLQUFLLEtBQUs7SUFFM0QsTUFBTUcsY0FBYyxNQUFNOUIscURBQU9BO0lBRWpDOEIsWUFBWUMsR0FBRyxDQUFDLFdBQVdiLFNBQVM7UUFDbENjLFVBQVU7UUFDVkMsUUFBUTtRQUNSQyxTQUFTVDtRQUNUVSxVQUFVO1FBQ1ZDLE1BQU07SUFDUjtBQUNGO0FBRU8sU0FBU0k7SUFDZCxPQUFPeEMscURBQU9BLEdBQUdzQyxHQUFHLENBQUM7QUFDdkI7QUFFTyxlQUFlRztJQUNwQixNQUFNWCxjQUFjLE1BQU05QixxREFBT0E7SUFFakM4QixZQUFZWSxNQUFNLENBQUM7QUFDckIiLCJzb3VyY2VzIjpbIi9ob21lL2Fzc2V0L3Byb2plY3RzL2FsbWFsZS9hbG1hbGUtbmV4dC9zcmMvYXBwL2xpYi9zZXNzaW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBcInNlcnZlci1vbmx5XCI7XG5pbXBvcnQgeyBjb29raWVzIH0gZnJvbSBcIm5leHQvaGVhZGVyc1wiO1xuaW1wb3J0IHsgU2lnbkpXVCwgand0VmVyaWZ5IH0gZnJvbSBcImpvc2VcIjtcblxuY29uc3Qgc2VjcmV0S2V5ID0gcHJvY2Vzcy5lbnYuU0VTU0lPTl9TRUNSRVQ7XG5jb25zdCBlbmNvZGVkS2V5ID0gbmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKHNlY3JldEtleSk7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBlbmNyeXB0KHBheWxvYWQpIHtcbiAgcmV0dXJuIG5ldyBTaWduSldUKHBheWxvYWQpXG4gICAgLnNldFByb3RlY3RlZEhlYWRlcih7IGFsZzogXCJIUzI1NlwiIH0pXG4gICAgLnNldElzc3VlZEF0KClcbiAgICAuc2V0RXhwaXJhdGlvblRpbWUoXCIxZFwiKVxuICAgIC5zaWduKGVuY29kZWRLZXkpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGVjcnlwdChzZXNzaW9uKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBwYXlsb2FkIH0gPSBhd2FpdCBqd3RWZXJpZnkoc2Vzc2lvbiwgZW5jb2RlZEtleSwge1xuICAgICAgYWxnb3JpdGhtczogW1wiSFMyNTZcIl0sXG4gICAgfSk7XG4gICAgcmV0dXJuIHBheWxvYWQ7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5sb2coXCJGYWlsZWQgdG8gdmVyaWZ5IHNlc3Npb25cIik7XG4gIH1cbn1cblxuLy8gZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZldGNoQ3JlYXRlU2Vzc2lvbihpZCkge1xuLy8gICB0cnkge1xuLy8gICAgIGNvbnN0IHVybCA9IG5ldyBVUkwoYCR7cHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU0lURV9VUkx9L2xpYi9hcGkvc2Vzc2lvbmApO1xuLy8gICAgIHVybC5zZWFyY2hQYXJhbXMuYXBwZW5kKFwiaWRcIiwgaWQpOyAvLyDQlNC+0LHQsNCy0LvRj9C10Lwg0L/QsNGA0LDQvNC10YLRgCBsYW5nXG4vLyAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2godXJsLnRvU3RyaW5nKCksIHtcbi8vICAgICAgIG1ldGhvZDogXCJQT1NUXCIsIC8vINCj0LrQsNC30YvQstCw0LXQvCDQvNC10YLQvtC0IFBPU1Rcbi8vICAgICAgIGhlYWRlcnM6IHtcbi8vICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsIC8vINCj0YHRgtCw0L3QsNCy0LvQuNCy0LDQtdC8INC30LDQs9C+0LvQvtCy0L7QulxuLy8gICAgICAgfSxcbi8vICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgaWQgfSksIC8vINCf0LXRgNC10LTQsNGR0Lwg0LTQsNC90L3Ri9C1INCyINGC0LXQu9C1INC30LDQv9GA0L7RgdCwXG4vLyAgICAgfSk7XG5cbi8vICAgICBpZiAoIXJlcy5vaykgdGhyb3cgbmV3IEVycm9yKFwi0J7RiNC40LHQutCwINC/0YDQuCDQt9Cw0LPRgNGD0LfQutC1INGC0L7QstCw0YDQvtCyXCIpO1xuLy8gICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCByZXMuanNvbigpO1xuLy8gICAgIHJldHVybiBzZXNzaW9uO1xuLy8gICB9IGNhdGNoIChlcnJvcikge1xuLy8gICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBwcm9kdWN0czpcIiwgZXJyb3IpO1xuLy8gICAgIHJldHVybiBbXTsgLy8g0JLQvtC30LLRgNCw0YnQsNC10Lwg0L/Rg9GB0YLQvtC5INC80LDRgdGB0LjQsiwg0LXRgdC70Lgg0L/RgNC+0LjQt9C+0YjQu9CwINC+0YjQuNCx0LrQsFxuLy8gICB9XG4vLyB9XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVTZXNzaW9uKGlkKSB7XG4gIGNvbnN0IGV4cGlyZXNBdCA9IG5ldyBEYXRlKERhdGUubm93KCkgKyA3ICogMjQgKiA2MCAqIDYwICogMTAwMCk7XG5cbiAgLy8gMi4gRW5jcnlwdCB0aGUgc2Vzc2lvbiBJRFxuXG4gIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBlbmNyeXB0KHtcbiAgICB1c2VySWQ6IGlkLFxuICAgIGV4cGlyZXNBdDogZXhwaXJlc0F0LFxuICAgIHJvbGU6IFwidXNlclwiLFxuICB9KTtcblxuICAvLyAzLiBTdG9yZSB0aGUgc2Vzc2lvbiBpbiBjb29raWVzIGZvciBvcHRpbWlzdGljIGF1dGggY2hlY2tzXG4gIGNvbnN0IGNvb2tpZVN0b3JlID0gYXdhaXQgY29va2llcygpO1xuICBjb29raWVTdG9yZS5zZXQoXCJzZXNzaW9uXCIsIHNlc3Npb24sIHtcbiAgICBodHRwT25seTogdHJ1ZSxcbiAgICBzZWN1cmU6IHRydWUsXG4gICAgZXhwaXJlczogZXhwaXJlc0F0LFxuICAgIHNhbWVTaXRlOiBcImxheFwiLFxuICAgIHBhdGg6IFwiL1wiLFxuICB9KTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVNlc3Npb24oKSB7XG4gIGNvbnN0IHNlc3Npb24gPSAoYXdhaXQgY29va2llcygpKS5nZXQoXCJzZXNzaW9uXCIpPy52YWx1ZTtcbiAgY29uc3QgcGF5bG9hZCA9IGF3YWl0IGRlY3J5cHQoc2Vzc2lvbik7XG5cbiAgaWYgKCFzZXNzaW9uIHx8ICFwYXlsb2FkKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjb25zdCBleHBpcmVzQXQgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgNyAqIDI0ICogNjAgKiA2MCAqIDEwMDApO1xuXG4gIGNvbnN0IGNvb2tpZVN0b3JlID0gYXdhaXQgY29va2llcygpO1xuXG4gIGNvb2tpZVN0b3JlLnNldChcInNlc3Npb25cIiwgc2Vzc2lvbiwge1xuICAgIGh0dHBPbmx5OiB0cnVlLFxuICAgIHNlY3VyZTogdHJ1ZSxcbiAgICBleHBpcmVzOiBleHBpcmVzQXQsXG4gICAgc2FtZVNpdGU6IFwibGF4XCIsXG4gICAgcGF0aDogXCIvXCIsXG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0U2Vzc2lvbkNvb2tpZSgpIHtcbiAgcmV0dXJuIGNvb2tpZXMoKS5nZXQoXCJzZXNzaW9uXCIpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGVsZXRlU2Vzc2lvbigpIHtcbiAgY29uc3QgY29va2llU3RvcmUgPSBhd2FpdCBjb29raWVzKCk7XG5cbiAgY29va2llU3RvcmUuZGVsZXRlKFwic2Vzc2lvblwiKTtcbn1cbiJdLCJuYW1lcyI6WyJjb29raWVzIiwiU2lnbkpXVCIsImp3dFZlcmlmeSIsInNlY3JldEtleSIsInByb2Nlc3MiLCJlbnYiLCJTRVNTSU9OX1NFQ1JFVCIsImVuY29kZWRLZXkiLCJUZXh0RW5jb2RlciIsImVuY29kZSIsImVuY3J5cHQiLCJwYXlsb2FkIiwic2V0UHJvdGVjdGVkSGVhZGVyIiwiYWxnIiwic2V0SXNzdWVkQXQiLCJzZXRFeHBpcmF0aW9uVGltZSIsInNpZ24iLCJkZWNyeXB0Iiwic2Vzc2lvbiIsImFsZ29yaXRobXMiLCJlcnJvciIsImNvbnNvbGUiLCJsb2ciLCJjcmVhdGVTZXNzaW9uIiwiaWQiLCJleHBpcmVzQXQiLCJEYXRlIiwibm93IiwidXNlcklkIiwicm9sZSIsImNvb2tpZVN0b3JlIiwic2V0IiwiaHR0cE9ubHkiLCJzZWN1cmUiLCJleHBpcmVzIiwic2FtZVNpdGUiLCJwYXRoIiwidXBkYXRlU2Vzc2lvbiIsImdldCIsInZhbHVlIiwiZ2V0U2Vzc2lvbkNvb2tpZSIsImRlbGV0ZVNlc3Npb24iLCJkZWxldGUiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(middleware)/./src/app/lib/session.js\n");

/***/ })

});