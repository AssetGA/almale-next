"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("src/middleware",{

/***/ "(middleware)/./src/app/lib/session.js":
/*!********************************!*\
  !*** ./src/app/lib/session.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createSession: () => (/* binding */ createSession),\n/* harmony export */   decrypt: () => (/* binding */ decrypt),\n/* harmony export */   deleteSession: () => (/* binding */ deleteSession),\n/* harmony export */   encrypt: () => (/* binding */ encrypt),\n/* harmony export */   getSessionCookie: () => (/* binding */ getSessionCookie),\n/* harmony export */   updateSession: () => (/* binding */ updateSession)\n/* harmony export */ });\n/* harmony import */ var server_only__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! server-only */ \"(middleware)/./node_modules/next/dist/compiled/server-only/empty.js\");\n/* harmony import */ var server_only__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(server_only__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/headers */ \"(middleware)/./node_modules/next/dist/esm/api/headers.js\");\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! jose */ \"(middleware)/./node_modules/jose/dist/browser/jwt/sign.js\");\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! jose */ \"(middleware)/./node_modules/jose/dist/browser/jwt/verify.js\");\n\n\n\nconst secretKey = process.env.SESSION_SECRET;\nconst encodedKey = new TextEncoder().encode(secretKey);\nasync function encrypt(payload) {\n    return new jose__WEBPACK_IMPORTED_MODULE_2__.SignJWT(payload).setProtectedHeader({\n        alg: \"HS256\"\n    }).setIssuedAt().setExpirationTime(\"1d\").sign(encodedKey);\n}\nasync function decrypt(session) {\n    try {\n        const { payload } = await (0,jose__WEBPACK_IMPORTED_MODULE_3__.jwtVerify)(session, encodedKey, {\n            algorithms: [\n                \"HS256\"\n            ]\n        });\n        return payload;\n    } catch (error) {\n        console.log(\"Failed to verify session\");\n    }\n}\n// export async function fetchCreateSession(id) {\n//   try {\n//     const url = new URL(`${process.env.NEXT_PUBLIC_SITE_URL}/lib/api/session`);\n//     url.searchParams.append(\"id\", id); // Добавляем параметр lang\n//     const res = await fetch(url.toString(), {\n//       method: \"POST\", // Указываем метод POST\n//       headers: {\n//         \"Content-Type\": \"application/json\", // Устанавливаем заголовок\n//       },\n//       body: JSON.stringify({ id }), // Передаём данные в теле запроса\n//     });\n//     if (!res.ok) throw new Error(\"Ошибка при загрузке товаров\");\n//     const session = await res.json();\n//     return session;\n//   } catch (error) {\n//     console.error(\"Error fetching products:\", error);\n//     return []; // Возвращаем пустой массив, если произошла ошибка\n//   }\n// }\nasync function createSession(id) {\n    const expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000);\n    // 2. Encrypt the session ID\n    const session = await encrypt({\n        userId: id,\n        expiresAt: expiresAt,\n        role: \"user\"\n    });\n    // 3. Store the session in cookies for optimistic auth checks\n    const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)();\n    cookieStore.set(\"session\", session, {\n        httpOnly: true,\n        secure: true,\n        expires: expiresAt,\n        sameSite: \"lax\",\n        path: \"/\"\n    });\n}\nasync function updateSession() {\n    const session = (await (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)()).get(\"session\")?.value;\n    const payload = await decrypt(session);\n    if (!session || !payload) {\n        return null;\n    }\n    const expires = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000);\n    const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)();\n    cookieStore.set(\"session\", session, {\n        httpOnly: true,\n        secure: true,\n        expires: expires,\n        sameSite: \"lax\",\n        path: \"/\"\n    });\n}\nfunction getSessionCookie() {\n    return (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)().get(\"session\");\n}\nasync function deleteSession() {\n    const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)();\n    cookieStore.delete(\"session\");\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKG1pZGRsZXdhcmUpLy4vc3JjL2FwcC9saWIvc2Vzc2lvbi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFxQjtBQUNrQjtBQUNHO0FBRTFDLE1BQU1HLFlBQVlDLFFBQVFDLEdBQUcsQ0FBQ0MsY0FBYztBQUM1QyxNQUFNQyxhQUFhLElBQUlDLGNBQWNDLE1BQU0sQ0FBQ047QUFFckMsZUFBZU8sUUFBUUMsT0FBTztJQUNuQyxPQUFPLElBQUlWLHlDQUFPQSxDQUFDVSxTQUNoQkMsa0JBQWtCLENBQUM7UUFBRUMsS0FBSztJQUFRLEdBQ2xDQyxXQUFXLEdBQ1hDLGlCQUFpQixDQUFDLE1BQ2xCQyxJQUFJLENBQUNUO0FBQ1Y7QUFFTyxlQUFlVSxRQUFRQyxPQUFPO0lBQ25DLElBQUk7UUFDRixNQUFNLEVBQUVQLE9BQU8sRUFBRSxHQUFHLE1BQU1ULCtDQUFTQSxDQUFDZ0IsU0FBU1gsWUFBWTtZQUN2RFksWUFBWTtnQkFBQzthQUFRO1FBQ3ZCO1FBQ0EsT0FBT1I7SUFDVCxFQUFFLE9BQU9TLE9BQU87UUFDZEMsUUFBUUMsR0FBRyxDQUFDO0lBQ2Q7QUFDRjtBQUVBLGlEQUFpRDtBQUNqRCxVQUFVO0FBQ1Ysa0ZBQWtGO0FBQ2xGLG9FQUFvRTtBQUNwRSxnREFBZ0Q7QUFDaEQsZ0RBQWdEO0FBQ2hELG1CQUFtQjtBQUNuQix5RUFBeUU7QUFDekUsV0FBVztBQUNYLHdFQUF3RTtBQUN4RSxVQUFVO0FBRVYsbUVBQW1FO0FBQ25FLHdDQUF3QztBQUN4QyxzQkFBc0I7QUFDdEIsc0JBQXNCO0FBQ3RCLHdEQUF3RDtBQUN4RCxvRUFBb0U7QUFDcEUsTUFBTTtBQUNOLElBQUk7QUFFRyxlQUFlQyxjQUFjQyxFQUFFO0lBQ3BDLE1BQU1DLFlBQVksSUFBSUMsS0FBS0EsS0FBS0MsR0FBRyxLQUFLLElBQUksS0FBSyxLQUFLLEtBQUs7SUFFM0QsNEJBQTRCO0lBRTVCLE1BQU1ULFVBQVUsTUFBTVIsUUFBUTtRQUM1QmtCLFFBQVFKO1FBQ1JDLFdBQVdBO1FBQ1hJLE1BQU07SUFDUjtJQUVBLDZEQUE2RDtJQUM3RCxNQUFNQyxjQUFjLE1BQU05QixxREFBT0E7SUFDakM4QixZQUFZQyxHQUFHLENBQUMsV0FBV2IsU0FBUztRQUNsQ2MsVUFBVTtRQUNWQyxRQUFRO1FBQ1JDLFNBQVNUO1FBQ1RVLFVBQVU7UUFDVkMsTUFBTTtJQUNSO0FBQ0Y7QUFFTyxlQUFlQztJQUNwQixNQUFNbkIsVUFBVSxDQUFDLE1BQU1sQixxREFBT0EsRUFBQyxFQUFHc0MsR0FBRyxDQUFDLFlBQVlDO0lBQ2xELE1BQU01QixVQUFVLE1BQU1NLFFBQVFDO0lBRTlCLElBQUksQ0FBQ0EsV0FBVyxDQUFDUCxTQUFTO1FBQ3hCLE9BQU87SUFDVDtJQUVBLE1BQU11QixVQUFVLElBQUlSLEtBQUtBLEtBQUtDLEdBQUcsS0FBSyxJQUFJLEtBQUssS0FBSyxLQUFLO0lBRXpELE1BQU1HLGNBQWMsTUFBTTlCLHFEQUFPQTtJQUNqQzhCLFlBQVlDLEdBQUcsQ0FBQyxXQUFXYixTQUFTO1FBQ2xDYyxVQUFVO1FBQ1ZDLFFBQVE7UUFDUkMsU0FBU0E7UUFDVEMsVUFBVTtRQUNWQyxNQUFNO0lBQ1I7QUFDRjtBQUVPLFNBQVNJO0lBQ2QsT0FBT3hDLHFEQUFPQSxHQUFHc0MsR0FBRyxDQUFDO0FBQ3ZCO0FBRU8sZUFBZUc7SUFDcEIsTUFBTVgsY0FBYyxNQUFNOUIscURBQU9BO0lBRWpDOEIsWUFBWVksTUFBTSxDQUFDO0FBQ3JCIiwic291cmNlcyI6WyIvaG9tZS9hc3NldC9wcm9qZWN0cy9hbG1hbGUvYWxtYWxlLW5leHQvc3JjL2FwcC9saWIvc2Vzc2lvbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXCJzZXJ2ZXItb25seVwiO1xuaW1wb3J0IHsgY29va2llcyB9IGZyb20gXCJuZXh0L2hlYWRlcnNcIjtcbmltcG9ydCB7IFNpZ25KV1QsIGp3dFZlcmlmeSB9IGZyb20gXCJqb3NlXCI7XG5cbmNvbnN0IHNlY3JldEtleSA9IHByb2Nlc3MuZW52LlNFU1NJT05fU0VDUkVUO1xuY29uc3QgZW5jb2RlZEtleSA9IG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShzZWNyZXRLZXkpO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZW5jcnlwdChwYXlsb2FkKSB7XG4gIHJldHVybiBuZXcgU2lnbkpXVChwYXlsb2FkKVxuICAgIC5zZXRQcm90ZWN0ZWRIZWFkZXIoeyBhbGc6IFwiSFMyNTZcIiB9KVxuICAgIC5zZXRJc3N1ZWRBdCgpXG4gICAgLnNldEV4cGlyYXRpb25UaW1lKFwiMWRcIilcbiAgICAuc2lnbihlbmNvZGVkS2V5KTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRlY3J5cHQoc2Vzc2lvbikge1xuICB0cnkge1xuICAgIGNvbnN0IHsgcGF5bG9hZCB9ID0gYXdhaXQgand0VmVyaWZ5KHNlc3Npb24sIGVuY29kZWRLZXksIHtcbiAgICAgIGFsZ29yaXRobXM6IFtcIkhTMjU2XCJdLFxuICAgIH0pO1xuICAgIHJldHVybiBwYXlsb2FkO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUubG9nKFwiRmFpbGVkIHRvIHZlcmlmeSBzZXNzaW9uXCIpO1xuICB9XG59XG5cbi8vIGV4cG9ydCBhc3luYyBmdW5jdGlvbiBmZXRjaENyZWF0ZVNlc3Npb24oaWQpIHtcbi8vICAgdHJ5IHtcbi8vICAgICBjb25zdCB1cmwgPSBuZXcgVVJMKGAke3Byb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NJVEVfVVJMfS9saWIvYXBpL3Nlc3Npb25gKTtcbi8vICAgICB1cmwuc2VhcmNoUGFyYW1zLmFwcGVuZChcImlkXCIsIGlkKTsgLy8g0JTQvtCx0LDQstC70Y/QtdC8INC/0LDRgNCw0LzQtdGC0YAgbGFuZ1xuLy8gICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKHVybC50b1N0cmluZygpLCB7XG4vLyAgICAgICBtZXRob2Q6IFwiUE9TVFwiLCAvLyDQo9C60LDQt9GL0LLQsNC10Lwg0LzQtdGC0L7QtCBQT1NUXG4vLyAgICAgICBoZWFkZXJzOiB7XG4vLyAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLCAvLyDQo9GB0YLQsNC90LDQstC70LjQstCw0LXQvCDQt9Cw0LPQvtC70L7QstC+0Lpcbi8vICAgICAgIH0sXG4vLyAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGlkIH0pLCAvLyDQn9C10YDQtdC00LDRkdC8INC00LDQvdC90YvQtSDQsiDRgtC10LvQtSDQt9Cw0L/RgNC+0YHQsFxuLy8gICAgIH0pO1xuXG4vLyAgICAgaWYgKCFyZXMub2spIHRocm93IG5ldyBFcnJvcihcItCe0YjQuNCx0LrQsCDQv9GA0Lgg0LfQsNCz0YDRg9C30LrQtSDRgtC+0LLQsNGA0L7QslwiKTtcbi8vICAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgcmVzLmpzb24oKTtcbi8vICAgICByZXR1cm4gc2Vzc2lvbjtcbi8vICAgfSBjYXRjaCAoZXJyb3IpIHtcbi8vICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgcHJvZHVjdHM6XCIsIGVycm9yKTtcbi8vICAgICByZXR1cm4gW107IC8vINCS0L7Qt9Cy0YDQsNGJ0LDQtdC8INC/0YPRgdGC0L7QuSDQvNCw0YHRgdC40LIsINC10YHQu9C4INC/0YDQvtC40LfQvtGI0LvQsCDQvtGI0LjQsdC60LBcbi8vICAgfVxuLy8gfVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlU2Vzc2lvbihpZCkge1xuICBjb25zdCBleHBpcmVzQXQgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgNyAqIDI0ICogNjAgKiA2MCAqIDEwMDApO1xuXG4gIC8vIDIuIEVuY3J5cHQgdGhlIHNlc3Npb24gSURcblxuICBjb25zdCBzZXNzaW9uID0gYXdhaXQgZW5jcnlwdCh7XG4gICAgdXNlcklkOiBpZCxcbiAgICBleHBpcmVzQXQ6IGV4cGlyZXNBdCxcbiAgICByb2xlOiBcInVzZXJcIixcbiAgfSk7XG5cbiAgLy8gMy4gU3RvcmUgdGhlIHNlc3Npb24gaW4gY29va2llcyBmb3Igb3B0aW1pc3RpYyBhdXRoIGNoZWNrc1xuICBjb25zdCBjb29raWVTdG9yZSA9IGF3YWl0IGNvb2tpZXMoKTtcbiAgY29va2llU3RvcmUuc2V0KFwic2Vzc2lvblwiLCBzZXNzaW9uLCB7XG4gICAgaHR0cE9ubHk6IHRydWUsXG4gICAgc2VjdXJlOiB0cnVlLFxuICAgIGV4cGlyZXM6IGV4cGlyZXNBdCxcbiAgICBzYW1lU2l0ZTogXCJsYXhcIixcbiAgICBwYXRoOiBcIi9cIixcbiAgfSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVTZXNzaW9uKCkge1xuICBjb25zdCBzZXNzaW9uID0gKGF3YWl0IGNvb2tpZXMoKSkuZ2V0KFwic2Vzc2lvblwiKT8udmFsdWU7XG4gIGNvbnN0IHBheWxvYWQgPSBhd2FpdCBkZWNyeXB0KHNlc3Npb24pO1xuXG4gIGlmICghc2Vzc2lvbiB8fCAhcGF5bG9hZCkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgY29uc3QgZXhwaXJlcyA9IG5ldyBEYXRlKERhdGUubm93KCkgKyA3ICogMjQgKiA2MCAqIDYwICogMTAwMCk7XG5cbiAgY29uc3QgY29va2llU3RvcmUgPSBhd2FpdCBjb29raWVzKCk7XG4gIGNvb2tpZVN0b3JlLnNldChcInNlc3Npb25cIiwgc2Vzc2lvbiwge1xuICAgIGh0dHBPbmx5OiB0cnVlLFxuICAgIHNlY3VyZTogdHJ1ZSxcbiAgICBleHBpcmVzOiBleHBpcmVzLFxuICAgIHNhbWVTaXRlOiBcImxheFwiLFxuICAgIHBhdGg6IFwiL1wiLFxuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFNlc3Npb25Db29raWUoKSB7XG4gIHJldHVybiBjb29raWVzKCkuZ2V0KFwic2Vzc2lvblwiKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZVNlc3Npb24oKSB7XG4gIGNvbnN0IGNvb2tpZVN0b3JlID0gYXdhaXQgY29va2llcygpO1xuXG4gIGNvb2tpZVN0b3JlLmRlbGV0ZShcInNlc3Npb25cIik7XG59XG4iXSwibmFtZXMiOlsiY29va2llcyIsIlNpZ25KV1QiLCJqd3RWZXJpZnkiLCJzZWNyZXRLZXkiLCJwcm9jZXNzIiwiZW52IiwiU0VTU0lPTl9TRUNSRVQiLCJlbmNvZGVkS2V5IiwiVGV4dEVuY29kZXIiLCJlbmNvZGUiLCJlbmNyeXB0IiwicGF5bG9hZCIsInNldFByb3RlY3RlZEhlYWRlciIsImFsZyIsInNldElzc3VlZEF0Iiwic2V0RXhwaXJhdGlvblRpbWUiLCJzaWduIiwiZGVjcnlwdCIsInNlc3Npb24iLCJhbGdvcml0aG1zIiwiZXJyb3IiLCJjb25zb2xlIiwibG9nIiwiY3JlYXRlU2Vzc2lvbiIsImlkIiwiZXhwaXJlc0F0IiwiRGF0ZSIsIm5vdyIsInVzZXJJZCIsInJvbGUiLCJjb29raWVTdG9yZSIsInNldCIsImh0dHBPbmx5Iiwic2VjdXJlIiwiZXhwaXJlcyIsInNhbWVTaXRlIiwicGF0aCIsInVwZGF0ZVNlc3Npb24iLCJnZXQiLCJ2YWx1ZSIsImdldFNlc3Npb25Db29raWUiLCJkZWxldGVTZXNzaW9uIiwiZGVsZXRlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(middleware)/./src/app/lib/session.js\n");

/***/ })

});