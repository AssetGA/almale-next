(()=>{var e={};e.id=9256,e.ids=[9256],e.modules={56037:e=>{"use strict";e.exports=require("mongoose")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},29021:e=>{"use strict";e.exports=require("fs")},81630:e=>{"use strict";e.exports=require("http")},55591:e=>{"use strict";e.exports=require("https")},33873:e=>{"use strict";e.exports=require("path")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},79551:e=>{"use strict";e.exports=require("url")},28354:e=>{"use strict";e.exports=require("util")},73566:e=>{"use strict";e.exports=require("worker_threads")},74075:e=>{"use strict";e.exports=require("zlib")},4573:e=>{"use strict";e.exports=require("node:buffer")},77598:e=>{"use strict";e.exports=require("node:crypto")},73024:e=>{"use strict";e.exports=require("node:fs")},57075:e=>{"use strict";e.exports=require("node:stream")},37830:e=>{"use strict";e.exports=require("node:stream/web")},57975:e=>{"use strict";e.exports=require("node:util")},44096:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>y,routeModule:()=>x,serverHooks:()=>w,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>g});var s={};t.r(s),t.d(s,{OPTIONS:()=>h,POST:()=>d});var o=t(42706),a=t(28203),i=t(45994),n=t(39187),u=t(62370),c=t(87328),l=t(85577);let p={messages:[]};async function d(e){if(await (0,u.$)(),!await (0,l.w)())return n.NextResponse.json({message:"No Verify"},{status:400});try{let{message:r}=await e.json();p.messages.push({role:c.N.roles.USER,content:`Ты консультант по продаже медной посуды и отвечаешь на вопросы исходя из возможностей продавца получаешь информацию из интернета и отвечаешь на заданные вопросы исходя из текста твоя задача описывать посуду бренда alma\`le информацию о посуде можно посмотреть на сайте alma-le.com твоя задача раскрыть лудшие стороны посуды чтобы посетителю понравилась посуда, цена за набор составляет 395000 тг по курсу Национального Банка Республики Казахстан Данный набор посуды мы доставляем по всему миру есть возможность купить за криптовалюту доставка оплачивается отдельно - ${r}`});let t=await c.N.chat(p.messages);return p.messages.push({role:c.N.roles.ASSISTANT,content:t.message.content}),n.NextResponse.json({reply:t.message.content},{status:200})}catch(e){return n.NextResponse.json({message:"На сервере произошла ошибка попробуйте позже"},{status:500})}}function h(){return n.NextResponse.json(null,{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, OPTIONS, PUT, PATCH, DELETE","Access-Control-Allow-Headers":"Origin, X-Requested-With, Content-Type, Accept"}})}let x=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/lib/api/chat/route",pathname:"/lib/api/chat",filename:"route",bundlePath:"app/lib/api/chat/route"},resolvedPagePath:"/home/asset/projects/almale/almale-next/src/app/lib/api/chat/route.js",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:g,serverHooks:w}=x;function y(){return(0,i.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:g})}},73247:(e,r,t)=>{"use strict";t.r(r),t.d(r,{"7f0b1c059b8da1d335a365b07007aa2d7506f30296":()=>s.$});var s=t(62370)},96487:()=>{},78335:()=>{},85577:(e,r,t)=>{"use strict";t.d(r,{w:()=>h,g:()=>d});var s=t(44512),o=t(89888);let a=process.env.SESSION_SECRET,i=new TextEncoder().encode(a);async function n(e){try{let{payload:r}=await (0,o.V)(e,i,{algorithms:["HS256"]});return r}catch(e){console.log("Failed to verify session")}}var u=t(76301),c=t(10928),l=t.n(c);t(31831);var p=t(62370);let d=(0,u.cache)(async()=>{let e=(await s.UL()).get("session")?.value,r=await n(e);return{isAuth:!0,userId:r?.userId,role:r?.role}}),h=(0,u.cache)(async()=>{let e=await d();if(!e)return null;await (0,p.$)();try{return await l().findById(e.userId)||null}catch(e){return console.error("Failed to fetch user:",e),null}})},87328:(e,r,t)=>{"use strict";t.d(r,{N:()=>i});var s=t(29021),o=t(25380);class a{constructor(){this.roles={ASSISTANT:"assistant",USER:"user",SYSTEM:"system"},this.openai=new o.Ay({apiKey:process.env.OPENAI_API_KEY},{timeout:12e4})}async chat(e){try{return(await this.openai.chat.completions.create({messages:e,model:"gpt-3.5-turbo",store:!0})).choices[0]}catch(e){console.log("Error while chat",e.message)}}async transcription(e){try{if(!(0,s.existsSync)(e))throw Error(`File not found: ${e}`);let r=(0,s.createReadStream)(e);return(await this.openai.audio.transcriptions.create({file:r,model:"whisper-1"})).text}catch(e){throw console.error("Error during transcription:",e.message),console.error("Статус ошибки:",e.status),console.error("Full error:",e),Error("Transcription failed. Please check the logs for more details.")}}}let i=new a},10928:(e,r,t)=>{"use strict";let{Schema:s,model:o,models:a}=t(56037),i=new s({name:{type:String,required:!0,minLength:3,maxLength:100},mobile:{type:String,required:!0,maxLength:30},email:{type:String,maxLength:200,required:!0},password:{type:String,required:!0,minLength:6}},{timestamps:!0}),n=a?.Users||o("Users",i);e.exports=n}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[5994,8410,4192,5452,3450,5380,2370],()=>t(44096));module.exports=s})();